// Folklore Page JavaScript

// Story data
const stories = {
    'birsa-munda': {
        title: 'The Legend of Birsa Munda',
        tribe: 'Munda Tribe',
        content: `
            <div class="story-full">
                <div class="story-image-full">
                    <img src="https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=800&h=400&fit=crop" alt="Birsa Munda">
                </div>
                <div class="story-meta-full">
                    <span class="story-tribe">Munda Tribe</span>
                    <span class="story-duration">12 min read</span>
                    <span class="story-type">Hero Legend</span>
                </div>
                <div class="story-text">
                    <p>In the dense forests of Jharkhand, where the Sal trees whispered ancient secrets and the rivers sang songs of freedom, was born a child destined to become a legend. Birsa Munda, born in 1875 in Ulihatu village, was no ordinary child—the tribal elders say the forest spirits themselves blessed him at birth.</p>
                    
                    <h4>The Awakening</h4>
                    <p>As a young boy, Birsa showed signs of extraordinary wisdom. He could communicate with animals, understand the language of the wind, and predict the changing seasons just by observing the flight patterns of birds. The tribal shamans recognized these as signs of divine calling.</p>
                    
                    <p>When Birsa came of age, he witnessed the suffering of his people under British colonial rule. The sacred forests were being destroyed, tribal lands were being taken away, and ancient customs were being suppressed. The forest spirits appeared to him in visions, urging him to rise and protect his people.</p>
                    
                    <h4>The Calling of the Forest</h4>
                    <p>One moonless night, deep in the heart of the forest, Birsa received his divine mission. The spirits of his ancestors appeared before him, led by the great spirit of the Sal tree. They spoke in unison:</p>
                    
                    <blockquote>"Rise, child of the earth. The time has come to awaken your people. Lead them back to their roots, restore their dignity, and drive away those who seek to destroy the harmony between man and nature."</blockquote>
                    
                    <p>From that moment, Birsa transformed from a simple tribal boy into a powerful leader. He began preaching about tribal rights, the importance of preserving nature, and the need to resist oppression. His words spread like wildfire through the tribal communities.</p>
                    
                    <h4>The Great Uprising</h4>
                    <p>Under Birsa's leadership, the tribal people united like never before. They rose against the British colonial system, the exploitative landlords, and the Christian missionaries who sought to convert them. The uprising, known as the "Birsa Movement" or "Ulgulan," became a symbol of resistance and freedom.</p>
                    
                    <p>Legend says that during battles, Birsa could summon the power of nature itself. Trees would bend to block enemy paths, rivers would change course to aid his warriors, and wild animals would fight alongside the tribal forces. Though these may be embellishments added by successive generations of storytellers, they reflect the deep reverence the tribal people had for their leader.</p>
                    
                    <h4>The Eternal Legacy</h4>
                    <p>Though Birsa's life was cut short at the age of 25, his spirit is said to still roam the forests of Jharkhand, protecting the tribal communities and their sacred lands. To this day, tribal people believe that when they face difficulties, they can call upon Birsa's spirit for guidance and strength.</p>
                    
                    <p>The story of Birsa Munda is not just a tale of heroism—it's a reminder of the eternal bond between the tribal people and their land, and the power of unity in the face of oppression. His legend continues to inspire new generations of tribal youth to take pride in their heritage and fight for their rights.</p>
                    
                    <div class="story-significance">
                        <h4>Cultural Significance</h4>
                        <p>This legend is traditionally narrated during the Birsa Jayanti celebrations and serves as a cornerstone of Munda tribal identity. It emphasizes themes of environmental protection, cultural preservation, and resistance against oppression that remain relevant today.</p>
                    </div>
                </div>
            </div>
        `
    },
    'sarhul-festival': {
        title: 'The Origin of Sarhul Festival',
        tribe: 'Santhal Tribe',
        content: `
            <div class="story-full">
                <div class="story-image-full">
                    <img src="https://images.unsplash.com/photo-1571896349842-33c89424de2d?w=800&h=400&fit=crop" alt="Sarhul Festival">
                </div>
                <div class="story-meta-full">
                    <span class="story-tribe">Santhal Tribe</span>
                    <span class="story-duration">8 min read</span>
                    <span class="story-type">Festival Origin</span>
                </div>
                <div class="story-text">
                    <p>Long, long ago, when the world was young and the boundary between the human and spirit worlds was thin, there lived a village where the people had forgotten how to celebrate the changing seasons. The Sal trees, which were the sacred messengers between earth and sky, began to wither and die.</p>
                    
                    <h4>The Dying Forest</h4>
                    <p>The village elder, Jatra, noticed that the Sal trees were losing their leaves even during the spring season. The flowers that once bloomed in abundance had disappeared, and the forest spirits seemed to have abandoned the land. Crops began to fail, animals fled to distant forests, and a sense of doom settled over the village.</p>
                    
                    <p>Desperate to understand what was happening, Jatra decided to spend seven days and nights in meditation under the oldest Sal tree in the forest, seeking guidance from the tree spirits.</p>
                    
                    <h4>The Vision of the Sal Goddess</h4>
                    <p>On the seventh night, as Jatra sat in deep meditation, the Sal tree began to glow with a golden light. From within the tree emerged a beautiful goddess, adorned with Sal flowers and leaves. Her voice was like the rustling of leaves in a gentle breeze:</p>
                    
                    <blockquote>"Oh, faithful elder, your people have forgotten the ancient covenant between humans and nature. The Sal trees are the bridge between the earthly realm and the divine. When spring arrives and we bloom, it is time for celebration, gratitude, and renewal. But your people have forgotten to honor this sacred time."</blockquote>
                    
                    <p>The goddess continued, "Establish a festival when the Sal trees bloom. Let your people dance, sing, and offer prayers to the trees. Let them make garlands of our flowers, share the first harvest, and renew their vows of harmony with nature. Only then will prosperity return to your land."</p>
                    
                    <h4>The First Sarhul</h4>
                    <p>Jatra returned to the village and shared his vision with the people. They immediately began preparations for the festival. When the Sal trees bloomed that spring, the entire village gathered in the forest. They danced around the trees, offered rice beer and flowers, and sang songs of gratitude.</p>
                    
                    <p>As the celebration reached its peak, something magical happened. The Sal trees began to bloom more abundantly than ever before. Their fragrance filled the air, attracting countless birds and butterflies. The forest came alive with the sounds of celebration from both humans and nature spirits.</p>
                    
                    <h4>The Eternal Blessing</h4>
                    <p>From that day forward, the Sal trees blessed the people with abundant blooms every spring, marking the beginning of the Sarhul festival. The celebration became a time of renewal, when tribal communities across the region would gather to honor nature, seek blessings for the coming year, and strengthen their bonds with the forest spirits.</p>
                    
                    <p>The tradition spread from village to village, carried by traveling musicians and storytellers. Each community added its own elements to the celebration, but the core remained the same: gratitude to the Sal trees and a renewal of the sacred bond between humans and nature.</p>
                    
                    <div class="story-significance">
                        <h4>Cultural Significance</h4>
                        <p>Sarhul, which literally means "worship of the Sal tree," remains one of the most important festivals for tribal communities in Jharkhand. It marks the beginning of the new year and is celebrated with traditional dances, songs, and offerings to nature. The festival embodies the tribal philosophy of living in harmony with nature and recognizing the interconnectedness of all life.</p>
                    </div>
                </div>
            </div>
        `
    },
    'drum-spirits': {
        title: 'The Sacred Drums and Forest Spirits',
        tribe: 'Ho Tribe',
        content: `
            <div class="story-full">
                <div class="story-image-full">
                    <img src="https://images.unsplash.com/photo-1540979388789-6cee28a1cdc9?w=800&h=400&fit=crop" alt="Sacred Drums">
                </div>
                <div class="story-meta-full">
                    <span class="story-tribe">Ho Tribe</span>
                    <span class="story-duration">10 min read</span>
                    <span class="story-type">Spirit Legend</span>
                </div>
                <div class="story-text">
                    <p>In the ancient Ho kingdom, nestled among the rolling hills of what is now Jharkhand, there lived a master drum maker named Budhu. His drums were unlike any others—they were said to possess the power to communicate with the forest spirits and call upon their protection in times of need.</p>
                    
                    <h4>The Gift of the Forest</h4>
                    <p>Budhu had learned his craft from his grandfather, who had received the knowledge directly from the forest spirits. The secret lay not just in the making of the drums, but in the ritual preparation of the materials. The wood had to be taken from trees that had been struck by lightning, the animal skin had to be from creatures that had lived full, natural lives, and most importantly, the maker had to fast for seven days while crafting the instrument.</p>
                    
                    <p>One particularly dark period in the village's history, when crops were failing and strange diseases were affecting both humans and animals, the village elders approached Budhu with a desperate request. They needed him to create the most powerful drum ever made—one that could reach the highest spirits and seek their intervention.</p>
                    
                    <h4>The Sacred Creation</h4>
                    <p>Budhu retreated deep into the forest and began his work. As he shaped the wood and stretched the hide, he could hear whispers in the wind—the voices of ancient spirits guiding his hands. Each strike of his tools resonated through the forest, and animals began to gather around him, as if drawn by an invisible force.</p>
                    
                    <p>On the seventh day, as he put the finishing touches on the drum, a magnificent stag appeared before him. The stag spoke in a voice that seemed to come from the earth itself:</p>
                    
                    <blockquote>"Master craftsman, you have created more than a drum—you have created a bridge between worlds. This instrument will serve your people well, but remember: its power must only be used for protection and harmony, never for harm or personal gain."</blockquote>
                    
                    <h4>The Test of Power</h4>
                    <p>That very night, the village was attacked by a band of raiders from a distant land. As the enemy approached, Budhu began to play the sacred drum. The sound that emerged was unlike anything the villagers had ever heard—it seemed to carry the voices of all the forest spirits, the roar of tigers, the trumpeting of elephants, and the wisdom of ancient trees.</p>
                    
                    <p>As the drumbeat echoed through the valley, an extraordinary thing happened. The forest itself came alive in defense of the village. Tigers emerged from the shadows to stand guard, elephants formed a protective barrier, and even the trees seemed to bend their branches to block the raiders' path. Faced with this supernatural defense, the attackers fled in terror.</p>
                    
                    <h4>The Legacy Continues</h4>
                    <p>From that night forward, the sacred drum became the guardian of the Ho people. It was passed down through generations of chosen guardians, each trained in the ancient rituals and sworn to use its power only for protection. The drum was played during important ceremonies, at times of crisis, and to maintain the sacred bond between the community and the forest spirits.</p>
                    
                    <p>Legend says that the drum still exists, hidden away and protected by the descendants of Budhu. On quiet nights, when the wind is still, people claim they can sometimes hear its distant beat echoing through the forests, reminding all who listen that the spirits are still watching over the land and its people.</p>
                    
                    <div class="story-significance">
                        <h4>Cultural Significance</h4>
                        <p>This legend reflects the Ho tribe's deep connection with nature and their belief in the protective power of ancestral spirits. Traditional Ho drums, known as "Dhol" and "Mandar," continue to play important roles in tribal ceremonies and festivals, serving as a link between the community and their spiritual heritage. The story emphasizes themes of responsibility, the proper use of power, and the ongoing relationship between humans and the natural world.</p>
                    </div>
                </div>
            </div>
        `
    },
    'water-goddess': {
        title: 'The Water Goddess of Hundru Falls',
        tribe: 'Oraon Tribe',
        content: `
            <div class="story-full">
                <div class="story-image-full">
                    <img src="https://images.unsplash.com/photo-1576013551627-0cc20b96c2a7?w=800&h=400&fit=crop" alt="Water Goddess">
                </div>
                <div class="story-meta-full">
                    <span class="story-tribe">Oraon Tribe</span>
                    <span class="story-duration">6 min read</span>
                    <span class="story-type">Nature Goddess</span>
                </div>
                <div class="story-text">
                    <p>High in the hills where the Subarnarekha River begins its journey to the sea, there once lived a goddess of extraordinary beauty and power. Her name was Hundru, and she was the guardian of all waters in the region. The magnificent waterfall that bears her name today was once her celestial palace, where she dwelt in harmony with all the creatures of the forest.</p>
                    
                    <h4>The Drought Years</h4>
                    <p>There came a time when the rains failed for three consecutive years. The rivers dried up, wells ran empty, and the once-lush forests began to turn brown and lifeless. The Oraon people, who had always lived in harmony with nature, were facing their greatest crisis. Crops withered in the fields, and both humans and animals suffered from the severe drought.</p>
                    
                    <p>The tribal elders gathered to seek a solution. After much discussion, they decided that someone must make the perilous journey to the sacred waterfall to seek the blessing of Hundru, the water goddess. A young and brave woman named Sita volunteered for this dangerous mission.</p>
                    
                    <h4>The Journey to the Sacred Falls</h4>
                    <p>Sita began her journey at dawn, carrying offerings of flowers, fruits, and sacred rice. The path to the waterfall was treacherous, winding through dense forests and steep rocky terrain. Along the way, she encountered various forest creatures who, recognizing her pure intentions, guided her toward her destination.</p>
                    
                    <p>When Sita finally reached the waterfall, she was amazed to find that despite the drought everywhere else, the water here still flowed with crystal clarity. As she knelt by the pool at the base of the falls to offer her prayers, the water began to glow with a soft, ethereal light.</p>
                    
                    <h4>The Appearance of the Goddess</h4>
                    <p>From the cascading waters emerged Hundru herself, radiant and beautiful beyond description. Her hair flowed like water, adorned with lotus flowers, and her eyes sparkled like the purest mountain springs. She spoke to Sita with a voice that sounded like the gentle murmur of a brook:</p>
                    
                    <blockquote>"Brave daughter of the earth, I have been waiting for someone with a pure heart to come seeking help for her people. The drought has not been caused by my anger, but by the imbalance that has crept into the world. Your people have forgotten the old ways of honoring the waters."</blockquote>
                    
                    <p>The goddess continued, "I will restore the rains and the rivers, but your people must promise to protect the waters, to never pollute them, and to always show gratitude for this precious gift. Establish a festival in my honor when the monsoons arrive, and teach your children to respect every drop of water as sacred."</p>
                    
                    <h4>The Great Blessing</h4>
                    <p>As soon as Sita agreed to these terms on behalf of her people, Hundru raised her hands toward the sky. Dark clouds began to gather from all directions, and within hours, the first drops of rain in three years began to fall. The drought was broken, and the land began to heal.</p>
                    
                    <p>Sita returned to her village with the message of the water goddess. The people immediately instituted the promised festival and rituals to honor Hundru. From that day forward, the region was blessed with abundant water resources, and the magnificent Hundru Falls became a sacred pilgrimage site.</p>
                    
                    <div class="story-significance">
                        <h4>Cultural Significance</h4>
                        <p>This legend explains the origin of water worship practices among the Oraon tribe and emphasizes the importance of environmental conservation. Hundru Falls, one of Jharkhand's most famous waterfalls, continues to be revered as a sacred site. The story teaches respect for natural resources and the consequences of environmental neglect, themes that remain highly relevant in contemporary discussions about water conservation and environmental protection.</p>
                    </div>
                </div>
            </div>
        `
    }
};

// Audio player simulation
let currentAudio = null;
let audioPlayers = {};

// Initialize folklore page
document.addEventListener('DOMContentLoaded', function() {
    initializeAudioPlayers();
    initializeScrollEffects();
    initializeModalHandlers();
});

// Smooth scrolling to sections
function scrollToSection(sectionId) {
    const section = document.getElementById(sectionId);
    if (section) {
        section.scrollIntoView({ 
            behavior: 'smooth',
            block: 'start'
        });
    }
}

// Story modal functions
function openStoryModal(storyId) {
    const story = stories[storyId];
    if (story) {
        const modal = document.getElementById('storyModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        
        modalTitle.textContent = story.title;
        modalBody.innerHTML = story.content;
        
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden';
        
        // Add fade-in animation
        setTimeout(() => {
            modal.style.opacity = '1';
        }, 10);
    }
}

function closeStoryModal() {
    const modal = document.getElementById('storyModal');
    modal.style.opacity = '0';
    
    setTimeout(() => {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }, 300);
}

// Audio player functions
function initializeAudioPlayers() {
    // Simulate audio players for demo purposes
    audioPlayers = {
        'story1': {
            duration: 932, // 15:32 in seconds
            currentTime: 0,
            isPlaying: false
        },
        'story2': {
            duration: 765, // 12:45 in seconds
            currentTime: 0,
            isPlaying: false
        },
        'story3': {
            duration: 558, // 9:18 in seconds
            currentTime: 0,
            isPlaying: false
        }
    };
}

function playAudio(audioId) {
    const audio = audioPlayers[audioId];
    const playIcon = document.getElementById(`play-icon-${audioId.slice(-1)}`);
    
    if (!audio) return;
    
    // Stop other audio if playing
    Object.keys(audioPlayers).forEach(id => {
        if (id !== audioId && audioPlayers[id].isPlaying) {
            pauseAudio(id);
        }
    });
    
    if (audio.isPlaying) {
        // Pause
        audio.isPlaying = false;
        playIcon.className = 'fas fa-play';
        if (currentAudio) {
            clearInterval(currentAudio);
            currentAudio = null;
        }
    } else {
        // Play
        audio.isPlaying = true;
        playIcon.className = 'fas fa-pause';
        
        // Simulate audio progress
        currentAudio = setInterval(() => {
            if (audio.currentTime >= audio.duration) {
                pauseAudio(audioId);
                audio.currentTime = 0;
                updateAudioDisplay(audioId);
                return;
            }
            
            audio.currentTime += 1;
            updateAudioDisplay(audioId);
        }, 1000);
    }
}

function pauseAudio(audioId) {
    const audio = audioPlayers[audioId];
    const playIcon = document.getElementById(`play-icon-${audioId.slice(-1)}`);
    
    if (audio) {
        audio.isPlaying = false;
        playIcon.className = 'fas fa-play';
        
        if (currentAudio) {
            clearInterval(currentAudio);
            currentAudio = null;
        }
    }
}

function updateAudioDisplay(audioId) {
    const audio = audioPlayers[audioId];
    const audioNumber = audioId.slice(-1);
    
    // Update progress bar
    const progressBar = document.getElementById(`progress-${audioNumber}`);
    const progressPercent = (audio.currentTime / audio.duration) * 100;
    if (progressBar) {
        progressBar.style.width = `${progressPercent}%`;
    }
    
    // Update current time
    const currentTimeElement = document.getElementById(`current-time-${audioNumber}`);
    if (currentTimeElement) {
        currentTimeElement.textContent = formatTime(audio.currentTime);
    }
}

function formatTime(seconds) {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = seconds % 60;
    return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
}

// Filter stories by community
function filterStories(tribe) {
    // This would filter and display stories by tribe in a real implementation
    console.log(`Filtering stories for tribe: ${tribe}`);
    
    // For now, just scroll to stories section
    scrollToSection('stories');
    
    // Add visual feedback
    const communityCards = document.querySelectorAll('.community-card');
    communityCards.forEach(card => {
        card.style.transform = 'scale(0.95)';
        card.style.opacity = '0.7';
    });
    
    // Reset after animation
    setTimeout(() => {
        communityCards.forEach(card => {
            card.style.transform = '';
            card.style.opacity = '';
        });
    }, 300);
}

// Initialize scroll effects
function initializeScrollEffects() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);
    
    // Observe story cards, audio cards, and community cards
    const elementsToObserve = document.querySelectorAll('.story-card, .audio-card, .community-card');
    elementsToObserve.forEach(element => {
        element.style.opacity = '0';
        element.style.transform = 'translateY(30px)';
        element.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(element);
    });
}

// Initialize modal handlers
function initializeModalHandlers() {
    // Close modals when clicking outside
    window.addEventListener('click', function(event) {
        const storyModal = document.getElementById('storyModal');
        if (event.target === storyModal) {
            closeStoryModal();
        }
    });
    
    // Close modals with Escape key
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            closeStoryModal();
        }
    });
}

// Utility function for smooth animations
function animateElement(element, animation, duration = 300) {
    element.style.transition = `all ${duration}ms ease`;
    
    if (animation === 'fadeIn') {
        element.style.opacity = '0';
        setTimeout(() => {
            element.style.opacity = '1';
        }, 10);
    } else if (animation === 'slideUp') {
        element.style.transform = 'translateY(20px)';
        element.style.opacity = '0';
        setTimeout(() => {
            element.style.transform = 'translateY(0)';
            element.style.opacity = '1';
        }, 10);
    }
}

// Add some interactive particles effect for hero section
function createParticleEffect() {
    const hero = document.querySelector('.folklore-hero');
    if (!hero) return;
    
    for (let i = 0; i < 50; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.cssText = `
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(99, 102, 241, 0.3);
            border-radius: 50%;
            pointer-events: none;
            left: ${Math.random() * 100}%;
            top: ${Math.random() * 100}%;
            animation: float ${5 + Math.random() * 10}s infinite linear;
        `;
        hero.appendChild(particle);
    }
    
    // Add floating animation
    const style = document.createElement('style');
    style.textContent = `
        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.3; }
            90% { opacity: 0.3; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }
    `;
    document.head.appendChild(style);
}

// Initialize particle effect
setTimeout(createParticleEffect, 1000);

// Animate numbers on load
function animateValue(obj, start, end, duration, suffix, hasPlus) {
    let startTimestamp = null;
    const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        const currentValue = Math.floor(progress * (end - start) + start);
        
        obj.innerHTML = currentValue.toLocaleString();

        if (progress < 1) {
            window.requestAnimationFrame(step);
        } else {
            // Animation finished, set final text
            let finalHTML = end.toLocaleString();
            if (hasPlus) {
                finalHTML += '+';
            }
            if (suffix) {
                finalHTML += ` ${suffix}`;
            }
            obj.innerHTML = finalHTML;
        }
    };
    window.requestAnimationFrame(step);
}

function initializeNumberAnimations() {
    // Add a check to prevent re-running
    if (document.body.classList.contains('numbers-animated')) {
        return;
    }
    document.body.classList.add('numbers-animated');

    const statNumbers = document.querySelectorAll('.stat-number, .community-stats .stat');
    
    statNumbers.forEach(stat => {
        const text = stat.textContent.trim();
        const match = text.match(/^(\d+)/);

        if (match) {
            const endValue = parseInt(match[1], 10);
            if (!isNaN(endValue)) {
                const hasPlus = text.includes('+');
                // Extract suffix, but exclude the '+' if it exists
                const suffix = text.replace(/^(\d+)\+?/, '').trim();
                
                // Clear the element before starting animation
                stat.innerHTML = '0';
                animateValue(stat, 0, endValue, 1500, suffix, hasPlus);
            }
        }
    });
}

document.addEventListener('DOMContentLoaded', initializeNumberAnimations);